# maticgasstation

## intro

**maticgasstation** - _Gas Price Recommender for Matic Network ( can be used on any EVM based network with JSON RPC interface )_

## origin

This project is inspired by [gasstation-express-oracle](https://github.com/ethgasstation/gasstation-express-oracle). Updated to work with Matic Network. 

## deployment

### init

- Make sure you've `npm (>=6.14.6)` & `node (>12.18.3)` installed
- Clone this repo in your machine
- Prepare a `.env` file & put it inside `/mgs` directory inside root of this project.

```bash
$ cd mgs && echo "SAFELOW=30
STANDARD=60
FAST=90
RPC=wss://ws-mumbai.matic.today
BUFFERSIZE=500
SINK=../sink.json" > .env
```

The gas price at which _>= 30 %_ of all transactions get accepted, called **SAFELOW**

The gas price at which _>= 60 %_ of all transactions get accepted, called **STANDARD**

The gas price at which _>= 90 %_ of all transactions get accepted, called **FAST**

The gas price at which all transactions get accepted, called **FASTEST** _( no need to specify it in .env file )_

Please use websocket endpoint for connecting to blockchain node. Transaction pool size is kept 500 i.e. 500 most recent transactions to be kept in pool, for recommending gas prices. SINK is where we're going publish recommendation, which will be served over HTTP GET request.

- Install all dependencies

```bash
$ npm install
```

- Now start gas station

```bash
$ node index.js
```

**Note: Consider deploying it using systemd**

### serve

- Time to run nodejs script that will serve recommended gas prices to mass, get into `serve` directory and install dependencies

```bash
$ cd serve
$ npm install # make sure you've node and npm installed
```

- Create a `config.env` file, for holding environment variables.

```bash
$ touch config.env
```

- Open `config.env` with your favourite text editor & add these fields.

```text
HOST=0.0.0.0
PORT=8000
TARGET_FILE=../output.json
```

- HOST : host machine ip, if not supplied, set to '127.0.0.1'
- PORT : port on which this application can be queried, by default set to 8000
- TARGET_FILE : path to sink file, where maticgasstation is putting its 
result, set in previous step. _[Don't put absolute path to sink file, relative path is fine, conversion to absolute path to be done by script, at runtime ]_
- Now start express application

```bash
$ node index.js # voila !!!
```

- And that's it :wink:


## output

- Result will be like _[generated by considering past 75 non-empty blocks from mainnet ethereum]_


```json
{
    "safeLow": 5,
    "standard": 5,
    "fast": 10,
    "fastest": 10,
    "blockTime": 2,
    "blockNumber": 2650006
}
```

- _{'safelow', 'standard', 'fast', 'fastest'}_ are gas prices in gwei
- _blockNumber_ indicates latest block when recommendation was made
- _blockTime_ in second
