# maticgasstation

## intro

_**maticgasstation** - Friend of a Matic developer_

_Tool for getting gas price recommendations before sending transactions off to matic network_

## origin

This project is inspired by [gasstation-express-oracle](https://github.com/ethgasstation/gasstation-express-oracle). Updated to work with Matic Network.

## progress

~~**This is active WIP**~~

**This will be maintained and improved overtime** :heavy_check_mark:

- Started adapting for matic network [03/07/2020]
- Completed writing, now works for Matic network [06/07/2020]
- More features to be added in near future

    - Multi-thearding support for faster performance _[ not implemented now due to race condition in threads, to be resolved ]_
    - Adding IPC based communication with node

## deployment

### starting **MaticGasStation**

- First thing first, simply clone this repo into host machine
- Prepare a config file like below, this needs to be supplied while invoking script. This config file holds information related to what percentage of blocks accepted in certain mininum gas price, rpc endpoint to be used for fetching data, #-of past blocks to be considered. ~~An example config file is supplied in this repo.~~

**Note: RPC endpoint needs to be adapted as per requirement. Consider using WebSocket endpoint if possible, other wise HTTP will also work fine.**

```json
{
    "safelow": 35,
    "standard": 60,
    "fast": 90,
    "rpc": "wss://testnetv3-wss.matic.network",
    "pastBlockCount": 200
}
```

- **Make sure you've Python( >= 3.7.0 )**
- Now install all dependencies by running

```bash
$ python3 -m pip install -r requirements.txt
```
- Install `flit` - easy to use for building PyPI packages and also for local use.

```bash
$ python3 -m pip install -U flit
```

- `flit init` has already been done, which is why `pyproject.toml` is generated.
- Now run, before that make sure you've added `$HOME/.local/bin` to `$PATH`.

```bash
$ flit install -s
```

- Now `maticGS` will be available on your `$PATH`.
- Run using 

```bash
$ maticGS config.json ~/sinkForGasPrice.json
```

### starting **Express App**

- Time to run nodejs script that will serve recommended gas prices to mass, get into `serve` directory and install dependencies

```bash
$ cd serve
$ npm install # make sure you've node and npm installed
```

- Create a `config.env` file, for holding environment variables.

```bash
$ touch config.env
```

- Open `config.env` with your favourite text editor & add these fields.

```text
HOST=0.0.0.0
PORT=8000
TARGET_FILE=../output.json
```

- HOST : host machine ip, if not supplied, set to '127.0.0.1'
- PORT : port on which this application can be queried, by default set to 8000
- TARGET_FILE : path to sink file, where maticgasstation is putting its 
result, set in previous step. _[Don't put absolute path to sink file, relative path is fine, conversion to absolute path to be done by script, at runtime ]_
- Now start express application

```bash
$ node index.js # voila !!!
```

- And that's it :wink:


## output

- Result will be like _[generated by considering past 75 non-empty blocks from mainnet ethereum]_


```json
{
    "safeLow": 20.0,
    "standard": 30.0,
    "fast": 33.0,
    "fastest": 45.0,
    "block_time": 15,
    "blockNum": 10429611
}
```

- _{'safelow', 'standard', 'fast', 'fastest'}_ are gas prices in gwei
- _blockNumber_ indicates latest block when recommendation was made
- _block\_time_ in second
